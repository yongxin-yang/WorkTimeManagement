---
description: 通过提出不超过 5 个高度聚焦的问题，识别当前特性规范中的欠明确区域，并将答案编码回规范。
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前（若不为空），你必须考虑用户输入。

## 概述

目标：发现并减少当前特性规范中的歧义与缺失决策点，并将澄清内容直接记录入规范文件。

说明：本澄清流程应在调用 `/speckit.plan` 之前运行并完成。若用户明确表示跳过澄清（如探索性 Spike），可继续，但需提示下游返工风险提升。

## 执行步骤

1. 在仓库根目录运行一次 `.specify/scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly`（组合 `--json --paths-only`），解析最小 JSON 字段：
   - FEATURE_DIR
   - FEATURE_SPEC
   - （可选保存 IMPL_PLAN、TASKS 以便后续链式流程）
   - 若解析失败，提示用户先运行 `/speckit.specify` 或检查特性分支环境。
   - 参数中单引号转义：'I'\''m Groot'（或使用双引号）。

2. 加载当前规范文件。按以下分类执行结构化歧义与覆盖扫描，对每类标记：清晰 / 部分 / 缺失，并生成内部覆盖图（除非不提问，否则不直接输出原始覆盖图）。

   功能范围与行为：
   - 核心用户目标与成功标准
   - 明确的非目标/出界声明
   - 用户角色/画像区分

   领域与数据模型：
   - 实体、属性、关系
   - 标识与唯一性规则
   - 生命周期/状态转移
   - 数据量/规模假设

   交互与 UX 流程：
   - 关键用户旅程/序列
   - 错误/空/加载状态
   - 无障碍与本地化

   非功能质量属性：
   - 性能（延迟、吞吐）
   - 可扩展性（横向/纵向、上限）
   - 可靠性与可用性（SLA、恢复期望）
   - 可观测性（日志、指标、链路追踪）
   - 安全与隐私（认证/授权、数据保护、威胁假设）
   - 合规/监管约束

   集成与外部依赖：
   - 外部服务/API 与失败模式
   - 数据导入/导出格式
   - 协议/版本假设

   边界与失败处理：
   - 负向场景
   - 限流/节流
   - 冲突解决（如并发编辑）

   约束与权衡：
   - 技术约束（语言、存储、托管）
   - 明确权衡与被拒替代方案

   术语与一致性：
   - 规范术语表
   - 避免同义词/废弃术语

   完成信号：
   - 验收标准可测试性
   - 可度量的 DoD 指示

   杂项/占位：
   - TODO/未决
   - 模糊形容词（“稳健”“直观”）缺少量化

   对“部分/缺失”的类别生成候选提问，除非：
   - 澄清不会实质改变实现或验证策略
   - 信息更适合在规划阶段确定（内部备注）

3. 内部生成候选澄清问题队列（最多 5 条）。不要一次性全部输出。约束：
   - 全会话问题总数 ≤ 10
   - 每题可用 2–5 个互斥选项 或 不超过 5 个词的短答
   - 仅包含会实质影响架构、数据建模、任务拆分、测试设计、UX 行为、运维就绪或合规验证的问题
   - 覆盖优先最高、影响最大、未解决的类别
   - 排除已答、琐碎风格、纯计划层细节（除非阻塞正确性）
   - 若>5 类未决，用（影响×不确定性）选前 5

4. 交互式单题循环：
   - 每次只呈现 1 个问题
   - 多选题：给出“推荐选项（含 1–2 句理由）”，并渲染表：

     | Option | Description |
     |--------|-------------|
     | A | ... |
     | B | ... |
     | C | ... |
     | Short | 不超过 5 个词的自由回答（仅当合适时） |

     之后提示：可回复字母、输入“yes/recommended”接受推荐，或提供短答。

   - 短答题：给出“建议答案（含简短理由）”，提示“<=5 词，可输入 yes/suggested 接受”。

   - 用户回答后：
     - 若为 yes/recommended/suggested，则采用推荐/建议
     - 否则校验是否对应选项或满足短答长度；若含糊则快速澄清（不计新题）
     - 记录于工作内存，然后进入下一题
   - 终止条件：关键歧义已解、用户停止、或达到 5 题
   - 若无有效问题，立即报告“无关键歧义”

5. 每个答案集成后立即更新规范（增量方式）：
   - 首次集成：确保存在 `## Clarifications`，并添加 `### Session YYYY-MM-DD`
   - 追加一行：`- Q: <问题> → A: <答案>`
   - 同步到最合适章节：
     - 功能歧义 → 功能需求
     - 角色/交互 → 用户故事/角色
     - 数据形态 → 数据模型（字段、类型、关系、约束）
     - 非功能约束 → 非功能/质量属性（将模糊词改为指标）
     - 边界/异常 → 边界/错误处理
     - 术语冲突 → 全文规范化（必要时保留一次“原称”注）
   - 若答案使旧语句失效，应直接替换而非重复
   - 每次写入后保存，保留格式与层级
   - 插入内容保持最小与可测试

6. 校验（每次写入后与最终）：
   - 每个已接收答案对应且仅对应一条澄清记录
   - 提问总数 ≤ 5
   - 已更新章节不再保留相关的模糊/占位
   - 消除矛盾陈述
   - Markdown 结构有效，仅新增“## Clarifications”“### Session YYYY-MM-DD”
   - 术语一致

7. 将更新写回 FEATURE_SPEC。

8. 完成报告：
   - 问题数量（已问/已答）
   - 规范路径
   - 触及的章节
   - 覆盖概要表（各分类状态：Resolved/Deferred/Clear/Outstanding）
   - 对 Outstanding/Deferred 的建议：继续 `/speckit.plan` 或稍后再澄清
   - 建议下一步命令

行为规则：
- 无关键歧义则报告并建议继续
- 缺规范文件则提示先运行 `/speckit.specify`
- 不超过 5 题（同题澄清不计入）
- 避免无根据的技术栈提问，除非阻塞功能清晰度
- 尊重用户提前结束
- 若覆盖充分且未提问，输出简洁覆盖总结并建议推进
- 若额度用尽仍有高影响未决，标记为 Deferred 并说明理由

优先级上下文：$ARGUMENTS
