---
description: 基于用户需求为当前特性生成定制化清单。
---

## 清单宗旨：“英文的单元测试”

关键概念：清单是“需求写作的单元测试”——用于验证特定领域中需求的质量、清晰度与完整性。

不用于验证/测试实现：

- ❌ 不是 “验证按钮能被点击”
- ❌ 不是 “测试错误处理是否工作”
- ❌ 不是 “确认 API 返回 200”
- ❌ 不是检查代码/实现是否匹配规范

用于需求质量校验：

- ✅ “所有卡片类型是否定义了视觉层级要求？”（完整性）
- ✅ “‘突出显示’是否用具体尺寸/位置量化？”（清晰度）
- ✅ “所有交互元素的悬停状态是否一致？”（一致性）
- ✅ “是否定义了键盘无障碍导航要求？”（覆盖性）
- ✅ “当 logo 图片加载失败时规范是否定义了行为？”（边界情况）

类比：若规范是英语写成的代码，清单就是其单元测试套件。你在测试需求是否写得好、是否完备与明确，而非实现是否能工作。

## 用户输入

```text
$ARGUMENTS
```

在继续之前（若不为空），你必须考虑用户输入。

## 执行步骤

1. 设置：在仓库根目录运行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json`，解析 FEATURE_DIR 与 AVAILABLE_DOCS。
   - 所有路径需为绝对路径。
   - 参数含单引号（如 "I'm Groot"）时转义：'I'\''m Groot'（或使用双引号）。

2. 明确意图（动态）：生成至多三条初始澄清问题（无预置题库）：
   - 基于用户表述 + 从 spec/plan/tasks 提取信号
   - 仅询问会实质改变清单内容的信息
   - 若 $ARGUMENTS 已清晰则跳过对应问题
   - 追求精度胜过广度

   生成步骤：
   1) 提取信号：领域关键词、风险指示、干系人、明确交付物等
   2) 聚类并排序关注域（≤4）
   3) 推断受众/时机（作者/评审/QA/发布）
   4) 识别缺失维度：范围、深度、风险、排除边界、可度量验收
   5) 形成问题原型：范围、风险优先级、深度校准、受众定位、边界排除、场景缺口

   格式规则：
   - 如呈现选项，输出表：Option | Candidate | Why It Matters
   - 选项不超过 A–E；若自由回答更清晰则不用表
   - 不要求用户复述既有信息
   - 避免臆测类别，拿不准就显式确认

   无法交互时默认：
   - 深度：标准
   - 受众：代码相关为评审，否则为作者
   - 聚焦：前两大相关簇

   输出 Q1/Q2/Q3。如≥2类场景未清晰，可再问至多两条（Q4/Q5），每条一行理由。不超过 5 条。若用户拒绝则停止追加。

3. 理解用户请求：结合 $ARGUMENTS + 答复：
   - 提炼清单主题（security/review/deploy/ux 等）
   - 汇总用户显式必需项
   - 将关注点映射到分类脚手架
   - 从 spec/plan/tasks 推断缺失上下文（不臆造）

4. 加载特性上下文（按需）：
   - spec.md（范围与需求）
   - plan.md（技术细节/依赖）
   - tasks.md（实现任务）
   - 渐进式取用，仅保留必要摘要

5. 生成清单——“英文单元测试”：
   - 若无目录则创建 `FEATURE_DIR/checklists/`
   - 文件命名：短小、可读的领域名，如 `ux.md`、`api.md`、`security.md`
   - 若文件已存在：在文件末尾追加
   - 条目编号从 CHK001 递增；每次运行创建新文件（不覆盖）

   核心原则：仅测试“需求本身”的质量：
   - 完整性、清晰度、一致性、可度量性、覆盖性

   分类结构（建议）：
   - 需求完整性 / 清晰度 / 一致性
   - 验收标准质量
   - 场景覆盖 / 边界情况
   - 非功能需求（性能/安全/无障碍等）
   - 依赖与假设 / 歧义与冲突

   写法准则——“英文单元测试”：
   - 错误示例（测实现）：
     - “Verify landing page displays 3 episode cards” 等
   - 正确示例（测需求）：
     - “featured 数量与布局是否明确规定？[Completeness]” 等

   条目结构：
   - 以“问题”形式询问需求的质量
   - 聚焦写在 spec/plan 的内容
   - 在方括号中注明维度标签
   - 可引用规范章节 `[Spec §X.Y]`，缺失用 `[Gap]`

   示例（维度）：
   - 完整性：API 失败模式是否定义错误处理？等
   - 清晰度：“fast loading” 是否给出时间阈值？等
   - 一致性：导航要求是否跨页面一致？等
   - 覆盖：零状态/并发互动/部分加载失败是否覆盖？等
   - 可度量：是否可客观验证？等
   - 场景分类：主/替代/异常/恢复/非功能，缺失则用 [Gap]
   - 可追溯性：≥80% 条目需含引用或标记（Spec/Gap/Ambiguity/Conflict/Assumption）

   严禁（将其变为实现测试）：
   - 任何以 Verify/Test/Confirm/Check + 行为 的表述
   - 代码/操作/系统行为引用、具体技术细节等

   必需模式（测需求质量）：
   - “是否为[场景]定义了[需求类型]？” 等

6. 结构参考：遵循 `.specify/templates/checklist-template.md`。若缺失模板：使用 H1 标题、目的/创建信息、`##` 类别分段，分段内采用 `- [ ] CHK### <item>` 格式，ID 自 CHK001 起全局递增。

7. 报告：输出创建的清单完整路径、条目数量，并总结：
   - 关注域、深度、受众/时机、已纳入的必需项

重要：每次 `/speckit.checklist` 都创建一个新清单文件。使用简短且可辨识的文件名，定期清理过时清单。

## 示例清单类型与样例

UX：`ux.md`；API：`api.md`；性能：`performance.md`；安全：`security.md`（均为“测试需求质量”的条目示例）。

## 反例：不要这样做

错误（测试实现，而非需求）：

```markdown
- [ ] CHK001 - Verify landing page displays 3 episode cards [Spec §FR-001]
...
```

正确（测试需求质量）：

```markdown
- [ ] CHK001 - Are the number and layout of featured episodes explicitly specified? [Completeness, Spec §FR-001]
...
```

关键差异：
- 错误：测试系统是否工作；正确：测试需求是否写好
- 错误：验证行为；正确：验证需求质量
- 错误：“是否做 X？”；正确：“X 是否被清晰规定？”
