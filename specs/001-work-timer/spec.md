# 特性规范：多功能计时软件

**特性分支**：`001-work-timer`  
**创建时间**：2025-01-27  
**状态**：草案  
**输入**：用户描述：“开发一个多功能计时软件，支持自动登录、时间分配统计、任务管理与工作模式切换等核心功能”

## 用户场景与测试（必填）

### 用户故事 1 - 启动应用并查看时间统计（优先级：P1）

用户启动应用后，系统自动无感登录，进入主页。用户点击“时间分配统计”入口，查看当天、本周、本月的各任务时间分配情况，通过可视化图表或数据汇总了解时间使用情况。

**优先级原因**：时间统计是核心价值，帮助用户理解时间使用模式，是其他功能的基础数据支撑。

**独立测试**：可通过启动应用 → 进入统计页面 → 切换天/周/月视图 → 查看数据展示，完全测试并交付时间统计价值。

**验收场景**：

1. **假设** 应用已安装并首次启动，**当** 用户打开应用，**那么** 系统自动完成登录，显示主页，包含三个主要入口（时间分配统计、工作模式、工作记录管理）和存储设置
2. **假设** 用户已使用工作模式记录了一段时间，**当** 用户点击"时间分配统计"入口，**那么** 系统显示当天时间分配情况，展示各任务的时间占比
3. **假设** 用户在统计页面，**当** 用户切换查看维度（天/周/月），**那么** 系统更新显示对应时间范围内的任务时间分配情况

---

### 用户故事 2 - 使用工作模式记录时间（优先级：P1）

用户进入工作模式，从下拉菜单选择一个或两个已存在的任务，点击“开始”按钮进入工作状态。工作过程中，用户可通过悬浮按钮（Windows 桌面或 Android 信息栏）快速切换任务。点击“结束”按钮结束工作状态。系统显示当前正在进行的任务，并在切换任务、开始/结束计时时提供弹窗提示。

**优先级原因**：工作模式是核心功能，提供实时时间记录能力，是数据采集的基础。

**独立测试**：可通过选择任务 → 开始工作 → 切换任务 → 结束工作 → 查看记录，完全测试并交付时间记录价值。

**验收场景**：

1. **假设** 用户在工作模式页面，**当** 用户从下拉菜单选择一个或两个任务，**那么** 系统显示选中的任务列表
2. **假设** 用户已选择任务，**当** 用户点击"开始"按钮，**那么** 系统进入工作状态，显示当前任务，并提供弹窗提示
3. **假设** 用户正在工作状态中，**当** 用户通过悬浮按钮切换任务，**那么** 系统更新当前任务显示，记录切换时间，并提供弹窗提示
4. **假设** 用户正在工作状态中，**当** 用户点击"结束"按钮，**那么** 系统结束工作状态，保存当前时间记录，并提供弹窗提示
5. **假设** 用户在工作过程中修改了当前任务类型，**当** 用户进行下一次切换，**那么** 系统在切换前保持当前记录不变，避免数据混乱

---

### 用户故事 3 - 管理工作记录和任务（优先级：P2）

用户进入工作记录管理页面，可以新建任务名称、管理任务信息（编辑、删除等）、转移或编辑已有工作记录。系统默认提供“工作”和“摸鱼”两个任务，这两个任务不可删除。

**优先级原因**：任务管理是支撑工作模式的基础，但可以在工作模式基本可用后完善。

**独立测试**：可通过创建新任务 → 编辑任务信息 → 编辑工作记录 → 尝试删除默认任务，完全测试并交付任务管理价值。

**验收场景**：

1. **假设** 用户在工作记录管理页面，**当** 用户创建新任务名称，**那么** 系统保存新任务，并在工作模式中可用
2. **假设** 用户在工作记录管理页面，**当** 用户编辑已有任务信息，**那么** 系统更新任务信息，已记录的时间数据保持不变
3. **假设** 用户在工作记录管理页面，**当** 用户尝试删除"工作"或"摸鱼"任务，**那么** 系统阻止删除操作，提示为系统默认任务
4. **假设** 用户在工作记录管理页面，**当** 用户编辑或转移已有工作记录，**那么** 系统更新记录关联的任务，统计数据相应更新

---

### 边界情况

- 当用户在工作过程中关闭应用时，系统如何处理未结束的工作记录？（应保存当前记录或提示用户）
- 当用户切换任务时，如果任务名称已被修改，系统如何自动更新记录？（应自动识别并更新）
- 当存储路径不可写时，系统如何处理？（应提示用户并允许更改存储设置）
- 当用户同时选择两个任务时，悬浮按钮如何表示当前任务？（应清晰显示当前活跃任务）
- 当时间统计查询大量数据时，系统响应时间如何？（应在合理时间内完成，不影响交互）
- 当系统突然断电或异常关闭时，系统如何处理未保存的工作记录？（启动时自动检查存储完整性，发现未完成记录时自动修复或提示用户恢复）
- 当存储文件损坏或数据不完整时，系统如何处理？（自动检测并尝试修复，修复失败时提示用户并保留备份）

## 需求（必填）

### 功能性需求

- **FR-001**：系统必须在启动时自动完成无感登录，无需用户手动验证
- **FR-002**：系统必须在主页提供三个主要入口：时间分配统计、工作模式、工作记录管理
- **FR-003**：系统必须在主页提供存储设置，默认存储路径为当前目录下的 storage 文件夹
- **FR-004**：系统必须支持查看天、周、月三个维度的时间分配情况
- **FR-005**：系统必须展示各任务或类别的时间占比（可视化图表或数据汇总）
- **FR-006**：用户必须能够通过下拉菜单选择一个或两个已存在的任务
- **FR-007**：系统必须实时显示当前正在进行的任务
- **FR-008**：系统必须提供“开始”按钮进入工作状态
- **FR-009**：系统必须提供“结束”按钮结束工作状态
- **FR-010**：系统必须在工作过程中提供任务切换功能，支持在两个任务之间快速切换
- **FR-011**：系统必须以悬浮按钮形式在 Windows 桌面或 Android 信息栏中显示任务切换键，便于快速操作
- **FR-012**：系统必须在切换任务时自动更新记录，若任务名称发生变化应自动识别
- **FR-013**：系统必须提供“工作”和“摸鱼”两个默认任务，且这两个任务不可删除
- **FR-014**：用户必须能够新建任务名称
- **FR-015**：用户必须能够管理任务信息（编辑、删除等）
- **FR-016**：用户必须能够转移或编辑已有工作记录
- **FR-017**：系统必须在切换任务、开始/结束计时时提供弹窗提示
- **FR-018**：系统必须在用户修改当前任务类型时，在下一次切换前保持当前记录不变，避免数据混乱
- **FR-019**：系统必须持久化所有时间记录和任务数据，支持本地独立运行
- **FR-020**：系统必须在每次启动时自动检查存储完整性，检测未完成的工作记录、损坏的数据文件或数据不一致
- **FR-021**：系统必须在检测到存储问题时自动尝试修复，包括恢复未完成的工作记录、修复数据文件结构、重建索引
- **FR-022**：系统必须在修复失败时提示用户并保留数据备份，允许用户选择恢复或丢弃损坏数据
- **FR-023**：系统必须在工作过程中定期保存状态（至少每 60 秒），确保异常关闭时数据损失最小化

### 关键实体（涉及数据时填写）

- **任务**：代表一个可记录时间的类别，包含名称、创建时间、是否可删除等属性；默认任务"工作"和"摸鱼"为系统必需
- **工作记录**：代表一段时间的记录，包含开始时间、结束时间、关联任务、持续时间、状态（进行中/已完成/已中断）等属性；记录可编辑、转移
- **时间统计**：按天、周、月维度聚合的工作记录，展示各任务的时间占比和总计

## 成功标准（必填）

### 可度量结果

- **SC-001**：用户可在启动应用后 3 秒内进入主页并看到所有功能入口
- **SC-002**：用户可在 10 秒内完成从主页到开始记录时间的操作流程，流程各步骤无错误或阻塞
- **SC-003**：用户可通过悬浮按钮在 2 秒内完成任务切换，无需回到主应用窗口，切换过程无数据丢失
- **SC-004**：系统在 1 万条工作记录规模下，时间统计查询在 3 秒内完成，查询结果准确无误
- **SC-005**：用户在时间统计页面可在 1 秒内切换查看维度（天/周/月），切换后数据展示完整且正确
- **SC-006**：系统在应用关闭后重新启动时，所有历史记录完整保留，数据不丢失；即使异常关闭（如断电），数据恢复率 ≥ 95%
- **SC-007**：90% 的用户首次使用即可理解并完成一次完整的工作记录流程（选择任务 → 开始 → 切换 → 结束），流程执行过程中无崩溃或功能错误
- **SC-008**：系统在检测到存储问题时，自动修复成功率 ≥ 90%，修复过程在 5 秒内完成，不影响用户正常使用
- **SC-009**：用户完成完整工作记录流程（选择任务 → 开始 → 切换 → 结束 → 查看统计）的流程完整性 ≥ 98%，即 98% 的流程执行不会因系统错误而中断
- **SC-010**：系统在正常使用场景下的错误率 ≤ 0.1%（包括数据丢失、计算错误、界面错误），用户操作流程无阻塞性缺陷

## 澄清

### 会话 2025-01-27

- **问**：边界情况是否需要考虑断电等异常关闭场景？ → **答**：是，需要添加存储完整性检查和自动修复功能，确保异常关闭时数据可恢复
- **问**：成功标准应如何侧重？ → **答**：偏向用户使用流程的完整性和无缺陷方向，增加流程完整性指标、错误率指标、数据恢复率指标
- **问**：文档语言要求？ → **答**：文档语言为纯中文，所有描述性内容、术语说明、验收场景均使用中文表达；技术标识符（如分支名、平台名）可保留英文
